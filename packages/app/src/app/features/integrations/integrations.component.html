<div class="page-header">
    <h2 class="page-title">Integrations</h2>
    <p class="page-subtitle">Connect external services to expand your CinemaCove experience.</p>
</div>

<div class="integration-grid">

    <!-- TMDB -->
    <mat-card class="integration-card" appearance="outlined">
        <div class="card-header">
            <span class="int-logo int-tmdb" aria-label="TMDB logo">TMDB</span>
            <div class="card-meta">
                <h3 class="card-title">The Movie Database</h3>
                <p class="card-desc">
                    Access your TMDB watchlists, favorites, and rated movies directly in your catalogs.
                </p>
            </div>
        </div>
        <mat-divider/>
        <div class="card-footer">
            @if (store.loading()) {
                <span class="status-chip">
                    <mat-spinner diameter="14" aria-label="Loading status"/>
                    Checking...
                </span>
                <span></span>
            } @else if (store.tmdbConnected()) {
                <span class="status-chip status-on">
                    <mat-icon aria-hidden="true">link</mat-icon>
                    {{ store.tmdbUsername() }}
                </span>
                <button mat-stroked-button
                        [disabled]="store.disconnecting()"
                        (click)="store.disconnectTmdb()"
                        aria-label="Disconnect TMDB account">
                    @if (store.disconnecting()) {
                        <mat-spinner diameter="18"/>
                    } @else {
                        Disconnect
                    }
                </button>
            } @else {
                <span class="status-chip status-off">
                    <mat-icon aria-hidden="true">link_off</mat-icon>
                    Not connected
                </span>
                <button mat-flat-button
                        [disabled]="store.connecting()"
                        (click)="store.connectTmdb()"
                        aria-label="Connect your TMDB account">
                    @if (store.connecting()) {
                        <mat-spinner diameter="18"/>
                    } @else {
                        Connect
                    }
                </button>
            }
        </div>
    </mat-card>

    <!-- Trakt -->
    <mat-card class="integration-card" appearance="outlined">
        <div class="card-header">
            <span class="int-logo int-trakt" aria-label="Trakt logo">trakt</span>
            <div class="card-meta">
                <h3 class="card-title">Trakt</h3>
                <p class="card-desc">
                    Sync your Trakt watch history, lists, and recommendations into your catalogs.
                </p>
            </div>
        </div>
        <mat-divider/>
        <div class="card-footer">
            <span class="status-chip status-off">
                <mat-icon aria-hidden="true">link_off</mat-icon>
                Not connected
            </span>
            <button mat-flat-button disabled aria-describedby="trakt-soon">
                Connect
            </button>
        </div>
        <p class="coming-soon-note" id="trakt-soon">Coming soon</p>
    </mat-card>

</div>

<!-- TMDB Lists -->
@if (store.tmdbConnected()) {
    <section class="lists-section" aria-labelledby="tmdb-lists-heading">
        <h3 class="section-title" id="tmdb-lists-heading">Your TMDB Lists</h3>
        <p class="section-subtitle">Install these as Stremio addons to stream directly from your lists.</p>

        @if (store.listsLoading()) {
            <div class="lists-loading" aria-label="Loading TMDB lists">
                <mat-spinner diameter="32"/>
            </div>
        } @else {
            <div class="lists-grid">
                @for (list of store.tmdbLists(); track list.listType + list.type) {
                    <mat-card class="list-card" appearance="outlined">
                        <div class="list-card-content">
                            <mat-icon class="list-icon" aria-hidden="true">{{ list.icon }}</mat-icon>
                            <div class="list-info">
                                <span class="list-label">{{ list.label }}</span>
                                <span class="list-count">{{ list.totalResults }} {{ list.type === 'movie' ? 'movies' : 'shows' }}</span>
                            </div>
                            <button mat-icon-button
                                    [disabled]="store.isInstalling()"
                                    [attr.aria-label]="'Install ' + list.label + ' as Stremio addon'"
                                    [matTooltip]="'Install on Stremio'"
                                    (click)="store.installTmdbList({ listType: list.listType, type: list.type, label: list.label })">
                                @if (isInstalling(list.listType, list.type)) {
                                    <mat-spinner diameter="20"/>
                                } @else {
                                    <mat-icon>download</mat-icon>
                                }
                            </button>
                        </div>
                    </mat-card>
                }
            </div>
        }
    </section>
}
